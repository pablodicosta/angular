<!DOCTYPE html>
<html ng-app="uiApp">
<head>
	<title>Exercise 7</title>
	<link rel="stylesheet" type="text/css" href="./styles.css">
	<link rel="stylesheet" type="text/css" href="/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/angular-ui-grid/ui-grid.min.css">
	<script type="text/javascript" src="/angular/angular.min.js"></script>
	<script type="text/javascript" src="/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
	<script type="text/javascript" src="/angular-ui-router/release/angular-ui-router.js"></script>
	<script type="text/javascript" src="/angular-ui-grid/ui-grid.min.js"></script>
	<script type="text/javascript" src="/angular-ui-utils/ui-utils.min.js"></script>
	<script type="text/javascript" src="/angular-google-maps/dist/angular-google-maps.min.js"></script>
	<script type="text/javascript" src="/angular-sanitize/angular-sanitize.min.js"></script>
	<script type="text/javascript" src="/lodash/dist/lodash.min.js"></script>
	<script type="text/javascript" src="/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="/bootstrap/dist/js/bootstrap.min.js"></script>

	<script type="text/javascript">

		var app = angular.module('uiApp', [
			'ui.bootstrap',
			'ui.router',
			'ui.utils',
			'ui.grid',
			'ui.grid.edit',
			'ui.grid.selection',
			'uiGmapgoogle-maps',
			'ngSanitize'
		]);

		app.config(function ($stateProvider, uiGmapGoogleMapApiProvider) {

			uiGmapGoogleMapApiProvider.configure();

			$stateProvider.state('home', {
				url: '',
				templateUrl: 'home.html',
				controller: 'homeCtrl',
				resolve: {
					lorem: function ($q, $http) {
						var deferred = $q.defer();
						$http.get('/rest/lorem').then(function (res) {
							deferred.resolve(res.data);
						});
						return deferred.promise;
					}
				}
			}).state('images', {
				templateUrl: 'images.html',
				controller: 'imagesCtrl'
			}).state('maps', {
				templateUrl: 'maps.html',
				controller: 'mapsCtrl'
			});

		});

		app.controller('mainCtrl', function($scope, $modal) {

			$scope.template = { nav: "nav.html" };

			$scope.openGreetModal = function () {
				var greetModal = $modal.open({
					templateUrl: 'greet.html',
					controller: 'greetModalCtrl',
					resolve: {
						name: function () {
							return $scope.name;
						}
					}
				});

				greetModal.result.then(function(name) {
					$scope.name = name;
				});
			};
		});

		app.controller('greetModalCtrl', function ($scope, $modalInstance, name) {

			$scope.name = name;

			$scope.ok = function () {
				$modalInstance.close($scope.name);
			};

			$scope.cancel = function () {
				$modalInstance.dismiss();
			};
		});

		app.controller('imagesCtrl', function ($scope) {

			$scope.imgs = [
				{ url: 'https://pbs.twimg.com/profile_images/2305843363/leqha8qaqwyjh9p9wx0k.jpeg' },
				{ url: 'http://www.triathlon.org.au/Assets/Triathlon+Australia+Digital+Assets/NSW/NSW+Events/NSW+Events+Images/kurnell+photo+3.jpg' },
				{ url: 'http://www.picturetopeople.org/images/artistic_mosaic_photo_effect_input.jpg' },
				{ url: 'http://www.google.com/+/images/learnmore/hero/hero-photos.jpg' }
			];

			$scope.gridOptions = {
				data: 'imgs',
				enableRowSelection: true,
				enableRowHeaderSelection: false,
				multiSelect: false,
				noUnselect: true,
				enableHorizontalScrollbar: false,
				enableVerticalScrollbar: false,
				enableSorting: false,
				columnDefs: [
					{ field: 'url', displayName: 'URL', enableColumnMenu: false, enableCellEdit: true }
				],
				onRegisterApi: function (gridApi) {
					$scope.gridApi = gridApi;
				}
			};

			$scope.add = function () {
				$scope.imgs.push({});
			};

			$scope.remove = function () {
				var item = $scope.gridApi.grid.selection.lastSelectedRow.entity;
					index = $scope.imgs.indexOf(item);
				$scope.imgs.splice(index, 1);
			};

		});

		app.controller('mapsCtrl', function ($scope, uiGmapGoogleMapApi) {
			uiGmapGoogleMapApi.then(function () {
				$scope.map = { center: { latitude: -32.892, longitude: -68.84 }, zoom: 16 };
			});
		});

		app.controller('homeCtrl', function ($scope, lorem) {
			$scope.lorem = lorem;
		});

	</script>
</head>
<body ng-controller="mainCtrl">

	<div ng-include="template.nav"></div>

	<div class="container">
		<div class="row" ng-if="name">
			<div class="well">
				<h4>Hello {{name}}!!</h4>
			</div>
		</div>
		<div class="row">
			<ui-view></ui-view>
		</div>
	</div>
	
</body>
</html>